/********************************************************************************************/
/********************************************************************************************/
/**************************		Author:  Ahmed Mohamed Mohamed Hassanien        *************/
/**************************		Date:    19 MARCH 2023	    	        		*************/
/**************************		Layer:   MCAL								   	*************/
/**************************		SWC:	 BROWNOUT								*************/
/**************************		Version: 1.00 	             					*************/
/********************************************************************************************/
/********************************************************************************************/


/********************************************************************************************/
/* Include libraries                                                                        */
/********************************************************************************************/

#include "STD_TYPES.h"
#include "BIT_MATH.h"

/********************************************************************************************/
/* Include Component Files                                                                  */
/********************************************************************************************/
#include "BROWNOUT_config.h"
#include "BROWNOUT_private.h"
#include "BROWNOUT_interface.h"

/*
----------------------------------------------------------------------------------------------------
!-                                  Global Variables
----------------------------------------------------------------------------------------------------
*/

/*
----------------------------------------------------------------------------------------------------
!-                                BROWNOUT Function  PROGRAM
----------------------------------------------------------------------------------------------------
*/

void BROWNOUT_voidInit(void)
{
    /** @def: Set the voltage threshold */
    PWR->CR &= (~(0b111 << 5u));
    PWR->CR |= ((BROWNOUT_THRESHOLD) << 5u);
    /** @def: Set the brownout mode */
    BIT_WRT(PWR->CR, PDDS, BROWNOUT_MODE);
    /** @def: Set the regulator config in stop mode */
#if (BROWNOUT_MODE == BROWNOUT_STOP_MODE)
    BIT_WRT(PWR->CR, LPDS, BROWNOUT_REGULATOR);
#else
    /* Do nothing */
#endif
    /** @def: Clear the main flags */
    BIT_CLR(PWR->CR, CSBF);
    BIT_CLR(PWR->CR, CWUF);
    /** @def: Enable/Disable the peripheral */
    BIT_WRT(PWR->CR, PVDE, BROWNOUT_STATE);
}/** @end BROWNOUT_voidInit */


/*
----------------------------------------------------------------------------------------------------
!-                                  BROWNOUT Function  PRIVATE
----------------------------------------------------------------------------------------------------
*/

